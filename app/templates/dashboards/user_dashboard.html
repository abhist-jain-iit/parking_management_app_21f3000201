{% extends 'base.html' %}
{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-2">
    <h2 class="mb-4">Welcome, {{ user.first_name }}!</h2>
    <div>
      <a href="{{ url_for('user.edit_profile') }}" class="btn btn-outline-primary">Edit Profile</a>
    </div>
  </div>
  <div class="row mb-4">
    <div class="col-md-4 mb-3">
      <div class="card h-100 shadow-sm">
        <div class="card-body">
          <h6 class="mb-2"><i class="fa fa-user text-primary"></i> Profile</h6>
          <div><b>Username:</b> {{ user.username }}</div>
          <div><b>Email:</b> {{ user.email }}</div>
          <div><b>Phone:</b> {{ user.phone }}</div>
        </div>
      </div>
    </div>
    <div class="col-md-4 mb-3">
      <div class="card h-100 shadow-sm">
        <div class="card-body">
          <h6 class="mb-2"><i class="fa fa-car text-success"></i> Active Reservations</h6>
          <div class="display-6" id="active-count">{{ active_reservations|length }}</div>
        </div>
      </div>
    </div>
    <div class="col-md-4 mb-3">
      <div class="card h-100 shadow-sm">
        <div class="card-body">
          <h6 class="mb-2"><i class="fa fa-history text-info"></i> Completed Reservations</h6>
          <div class="display-6" id="completed-count">{{ completed_reservations|length }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Summary & Chart -->
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="card shadow-sm mb-3">
        <div class="card-body">
          <h6 class="mb-2"><i class="fa fa-chart-bar text-warning"></i> Parking Summary</h6>
          <div id="summary-section">
            <div>Total Bookings: <span id="summary-bookings">-</span></div>
            <div>Total Time Parked (hrs): <span id="summary-time">-</span></div>
            <div>Total Amount Spent: â‚¹<span id="summary-amount">-</span></div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card shadow-sm mb-3">
        <div class="card-body">
          <canvas id="summaryChart" height="120"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabs for Reservations -->
  <ul class="nav nav-tabs mb-3" id="userTab" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="active-tab" data-bs-toggle="tab" data-bs-target="#active" type="button" role="tab">Active Reservations</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="completed-tab" data-bs-toggle="tab" data-bs-target="#completed" type="button" role="tab">Completed</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="cancelled-tab" data-bs-toggle="tab" data-bs-target="#cancelled" type="button" role="tab">Cancelled</button>
    </li>
  </ul>
  <div class="tab-content" id="userTabContent">
    <!-- Active Reservations -->
    <div class="tab-pane fade show active" id="active" role="tabpanel">
      <div class="card mb-3">
        <div class="card-header bg-success text-white"><i class="fa fa-car"></i> Active Reservations</div>
        <div class="card-body p-0">
          <table class="table table-bordered table-striped mb-0">
            <thead class="table-light">
              <tr>
                <th>Spot</th>
                <th>Lot</th>
                <th>Start Time</th>
                <th>End Time</th>
                <th>Status</th>
                <th>Cost</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="active-reservations-body-js"></tbody>
          </table>
          <div id="active-pagination" class="my-2" style="display:none;">
            <button class="btn btn-sm btn-outline-secondary" id="active-prev">Prev</button>
            <span id="active-page-info" class="mx-2"></span>
            <button class="btn btn-sm btn-outline-secondary" id="active-next">Next</button>
          </div>
        </div>
      </div>
    </div>
    <!-- Completed Reservations -->
    <div class="tab-pane fade" id="completed" role="tabpanel">
      <div class="card mb-3">
        <div class="card-header bg-info text-white"><i class="fa fa-check-circle"></i> Completed Reservations</div>
        <div class="card-body p-0">
          <table class="table table-bordered table-striped mb-0">
            <thead class="table-light">
              <tr>
                <th>Spot</th>
                <th>Lot</th>
                <th>Start Time</th>
                <th>End Time</th>
                <th>Status</th>
                <th>Cost</th>
              </tr>
            </thead>
            <tbody id="completed-reservations-body-js"></tbody>
          </table>
          <div id="completed-pagination" class="my-2" style="display:none;">
            <button class="btn btn-sm btn-outline-secondary" id="completed-prev">Prev</button>
            <span id="completed-page-info" class="mx-2"></span>
            <button class="btn btn-sm btn-outline-secondary" id="completed-next">Next</button>
          </div>
        </div>
      </div>
    </div>
    <!-- Cancelled Reservations -->
    <div class="tab-pane fade" id="cancelled" role="tabpanel">
      <div class="card mb-3">
        <div class="card-header bg-danger text-white"><i class="fa fa-times-circle"></i> Cancelled Reservations</div>
        <div class="card-body p-0">
          <table class="table table-bordered table-striped mb-0">
            <thead class="table-light">
              <tr>
                <th>Spot</th>
                <th>Lot</th>
                <th>Start Time</th>
                <th>End Time</th>
                <th>Status</th>
                <th>Cost</th>
              </tr>
            </thead>
            <tbody id="cancelled-reservations-body-js"></tbody>
          </table>
          <div id="cancelled-pagination" class="my-2" style="display:none;">
            <button class="btn btn-sm btn-outline-secondary" id="cancelled-prev">Prev</button>
            <span id="cancelled-page-info" class="mx-2"></span>
            <button class="btn btn-sm btn-outline-secondary" id="cancelled-next">Next</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
